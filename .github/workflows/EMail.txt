- name: Email success (attachment)
        if: success()
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: ${{ secrets.SMTP_HOST }}
          server_port: ${{ secrets.SMTP_PORT }}
          username: ${{ secrets.SMTP_USER }}
          password: ${{ secrets.SMTP_PASS }}
          subject: "WhiteShorts ✅ predictions for $(date -u +%F) run ${{ github.run_id }}"
          to: ${{ secrets.EMAIL_TO }}
          from: WhiteShorts Bot <${{ secrets.EMAIL_FROM }}>
          secure: true
          attachments: artifacts/predictions.csv
          body: |
            Hi,
            Predictions attached.
            Repository: ${{ github.repository }}
            Run: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
            Timestamp (UTC): $(date -u)

  notify-failure:
    if: failure()
    runs-on: ubuntu-latest
    needs: [predict]
    steps:
      - name: Send failure email
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: ${{ secrets.SMTP_HOST }}
          server_port: ${{ secrets.SMTP_PORT }}
          username: ${{ secrets.SMTP_USER }}
          password: ${{ secrets.SMTP_PASS }}
          subject: "WhiteShorts ❌ FAILED run ${{ github.run_id }}"
          to: ${{ secrets.EMAIL_TO }}
          from: Elfie in WhiteShorts Bot <${{ secrets.EMAIL_FROM }}>
          secure: true
          body: |
            Workflow failed.
            Check logs: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
